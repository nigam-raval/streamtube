services:
    mongodb:
      image: mongo
      container_name: mongodb
      restart: always
      environment:
        MONGO_INITDB_ROOT_USERNAME: ${DB_ROOT_USERNAME}
        MONGO_INITDB_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      ports:
        - 127.0.0.1:27017:27017
      networks:
          - streamtube
      volumes:
        - mongodb-data:/data/db

    postgres:
      image: postgres:18
      container_name: postgresdb
      restart: always
      environment:
        POSTGRES_USER: ${PGUSER}
        POSTGRES_PASSWORD: ${PGPASSWORD}
        POSTGRES_DB: ${PGDATABASE}
      ports:
        - "127.0.0.1:5432:5432"
      networks:
          - streamtube
      volumes:
        - pg-data:/var/lib/postgresql
    pgadmin:
      image: dpage/pgadmin4:latest
      container_name: pgadmin
      restart: always
      environment:
        PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL}
        PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD}
      networks:
        - streamtube
      ports:
        - "127.0.0.1:5050:80"
      depends_on:
        - postgres
      volumes:
        - pgadmin-data:/var/lib/pgadmin

    bucket-storage:
      image: minio/minio:latest
      container_name: minio 
      environment:
        MINIO_ROOT_USER: ${STORAGE_ACCESS_KEY}
        MINIO_ROOT_PASSWORD: ${STORAGE_SECRET_KEY}
        # for event notfication
        MINIO_NOTIFY_AMQP_ENABLE_rabbitmq1: ${MINIO_NOTIFY_AMQP_ENABLE_rabbitmq1}
        MINIO_NOTIFY_AMQP_URL_rabbitmq1: ${MINIO_NOTIFY_AMQP_URL_rabbitmq1}
        MINIO_NOTIFY_AMQP_EXCHANGE_rabbitmq1: ${MINIO_NOTIFY_AMQP_EXCHANGE_rabbitmq1}
        MINIO_NOTIFY_AMQP_EXCHANGE_TYPE_rabbitmq1: ${MINIO_NOTIFY_AMQP_EXCHANGE_TYPE_rabbitmq1}
        MINIO_NOTIFY_AMQP_ROUTING_KEY_rabbitmq1: ${MINIO_NOTIFY_AMQP_ROUTING_KEY_rabbitmq1}
        MINIO_NOTIFY_AMQP_DELIVERY_MODE_rabbitmq1: ${MINIO_NOTIFY_AMQP_DELIVERY_MODE_rabbitmq1}
        MINIO_NOTIFY_AMQP_DURABLE_rabbitmq1: ${MINIO_NOTIFY_AMQP_DURABLE_rabbitmq1}
      ports:
        - 9000:9000  # HTTP port for MinIO
        - 127.0.0.1:9001:9001  # Port for MinIO Web UI (optional)
      networks:
          - streamtube
      volumes:
        - minio-data:/data
        - ../../infra/s3/:/config/
      command: server /data --console-address ":9001"
      restart: always
      
    rabbitmq:
        container_name: rabbitmq
        image: rabbitmq:4-management
        volumes:
          - rabbitmq-data:/var/lib/rabbitmq  
        ports:
            - 5672:5672
            - 127.0.0.1:15672:15672
        networks:
          - streamtube
        restart: always


volumes:
  mongodb-data:
  minio-data:
  pg-data:
  pgadmin-data:
  rabbitmq-data:

networks:
  streamtube:
   external: true





